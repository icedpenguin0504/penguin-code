---
title: 正規表現で一致するパターンの中から一部分だけマッチさせる
tags:
  - 正規表現
category:
  - Tech
  - プログラミング
date: 2020-09-19 19:51:58
---

マッチする部分だけではなく、その前後のパターンまで指定する方法です。
一定のパターンの一部分だけを取り出すイメージです。

<!-- more -->

## 環境

- macOS 10.15.6

# 前後のパターンを指定する

## 先読み・後読み

正規表現の先読み、後読みと呼ばれる機能を使います。

先読みは直後のパターンを指定します。また、後読みは直前のパターンを指定するものです。

いくつか種類があるので、次の表にまとめておきます。
正直、命名が全く直感的ではないと思いますが...。

|              | 書式      | 意味                             |
|--------------|-----------|----------------------------------|
| 肯定的先読み | `A(?=B)`  | 直後がBが一致する場合にAに一致   |
| 否定的先読み | `A(?!B)`  | 直後がBに一致しない場合にAに一致 |
| 肯定的後読み | `(?<=A)B` | 直前がAに一致する場合にBに一致   |
| 否定的後読み | `(?<!A)B` | 直前がAに一致しない場合にBに一致 |

A、Bには正規表現を用いることができます。


## 例

上の説明ではよく分からないと思います。ということで具体例。

```
(?<=hoge)fuga(?=baz)
```

直前にhoge、直後にbazがあるようなfugaにマッチします。例えば、`hogefugabaz`の中のfugaにマッチします。

```
(?<!hoge)fuga(?!baz)
```

直前がhogeでなく、かつ直後がbazでないようなfugaにマッチします。
例えば、`hogefugahoge`にはマッチしませんが、`bazfugahoge`の中のfugaにマッチします。

```
(?<=SELECT ).+(?= FROM .+( WHERE [\s\S]+)*)
```

`SELECT column_name FROM table_name WHERE id = 1;`に対して`column_name`がマッチします。

# まとめ

一致するパターンの中から特定の一部分だけを取り出す方法をまとめました。

正規表現難しい。すぐ忘れるのでことあるごとにまとめていこうと思います。

## 参考

- [正規表現の先読み・後読みを極める！](https://abicky.net/2010/05/30/135112/)
